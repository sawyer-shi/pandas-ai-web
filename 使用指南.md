# Pandas AI Web 使用指南

## 快速开始

1. **配置环境**
   - 复制`.env.example`文件并重命名为`.env`
   - 在`.env`文件中填入你的API密钥和模型配置
   - 如果使用Ollama，需要单独安装（见下方说明）

2. **安装依赖**
   ```
   pip install -r requirements.txt
   ```

3. **启动应用**
   ```
   python app.py
   ```
   
4. **使用浏览器访问应用**
   - 默认地址: http://127.0.0.1:7860

## 环境配置说明

在`.env`文件中可以配置以下参数：

```
# 默认AI模型类型 (可选项: "OpenAI", "Azure", "Ollama")
DEFAULT_LLM_TYPE=Ollama

# OpenAI API配置
OPENAI_API_KEY=your_openai_api_key_here

# Azure OpenAI API配置
AZURE_OPENAI_API_KEY=your_azure_openai_api_key_here
AZURE_OPENAI_ENDPOINT=your_azure_openai_endpoint_here
AZURE_OPENAI_DEPLOYMENT_NAME=your_deployment_name_here
AZURE_OPENAI_API_VERSION=2023-05-15

# Ollama配置
OLLAMA_MODEL=llama3
OLLAMA_BASE_URL=http://localhost:11434
```

根据你要使用的AI模型，填写相应的配置项。

### Azure OpenAI配置说明

如果你选择使用Azure OpenAI服务，需要填写以下参数：

1. **API密钥（AZURE_OPENAI_API_KEY）**：从Azure门户获取的API密钥
2. **端点URL（AZURE_OPENAI_ENDPOINT）**：Azure OpenAI服务的端点URL
3. **部署名称（AZURE_OPENAI_DEPLOYMENT_NAME）**：这是你在Azure门户中创建的特定模型部署的名称，**必填项**
4. **API版本（AZURE_OPENAI_API_VERSION）**：指定要使用的Azure OpenAI API版本，默认为"2023-05-15"

> **API版本说明**：根据您使用的Azure OpenAI功能，可能需要指定不同的API版本。常见选项包括：
> - "2023-05-15"：标准版本
> - "2023-07-01-preview"：预览版，支持一些新功能
> - "2023-12-01-preview"：更新的预览版
> - "2024-02-15-preview"：最新预览版
>
> 部署名称是在Azure OpenAI Studio中创建模型部署时指定的名称，不是模型名称本身。例如，你可能命名为"gpt-4"、"gpt-35-turbo"等。

## 详细使用步骤

### 数据上传与分析

1. 在左侧选择一种AI模型（OpenAI、Azure或Ollama）
2. 上传CSV、XLS或XLSX格式的数据文件
3. 等待数据加载和AI模型初始化完成
4. 在右侧聊天框中输入你的问题
5. 查看AI生成的回答和图表分析（如果有）

### 使用会话历史功能

1. **查看历史对话记录**
   - 页面底部的"对话记录"标签页中可以看到当前会话的所有问答记录
   - 点击"刷新对话记录"按钮可以更新显示

2. **切换历史会话**
   - 在"历史会话"标签页中可以看到所有上传过的数据文件会话
   - 选择一个历史会话后，聊天界面会加载该会话的所有对话内容
   - 你可以继续在该历史会话中提问

3. **自动会话管理**
   - 每次上传新数据文件时，系统会自动创建一个新的会话
   - 所有会话数据保存在SQLite数据库中，完全关闭应用后再打开仍可访问

### 语言切换与多语言支持

1. **切换界面语言**
   - 在页面顶部选择中文或英文界面

2. **自动语言检测**
   - 系统会自动检测你提问的语言（中文或英文）
   - AI会以相同的语言回答你的问题，不需要显式指定

### Ollama特别说明

如果你选择使用Ollama，需要先完成以下步骤：

1. 从[Ollama官网](https://ollama.com/)下载并安装Ollama应用
2. 打开命令行（终端），运行以下命令下载所需模型：
   ```
   ollama pull llama3
   ```
   你也可以下载其他模型，如：
   ```
   ollama pull mistral
   ollama pull gemma
   ```
3. 确保Ollama服务在后台运行
4. 在`.env`文件中设置Ollama相关参数：
   ```
   DEFAULT_LLM_TYPE=Ollama
   OLLAMA_MODEL=llama3
   OLLAMA_BASE_URL=http://localhost:11434
   ```

## 常见问题

1. **为什么我的问题没有得到回答?**
   - 确保你已正确上传数据文件
   - 确保你已在`.env`文件中正确配置了API密钥或模型信息
   - 尝试使用更明确的问题，例如"计算销售额的总和"而不是"销售情况如何"

2. **我想生成图表但没有生成怎么办?**
   - 在提问时明确要求生成图表，例如"绘制销售额随时间的变化趋势图"
   - 使用图表相关关键词如：绘制、画图、生成图表、显示、可视化等

3. **如何管理历史会话?**
   - 目前不支持手动删除历史会话，但你可以创建新会话
   - 如果需要完全清除历史数据，可以删除`chat_history.db`文件，系统将自动创建新数据库

4. **数据库错误怎么解决?**
   - 如果遇到SQLite数据库错误，可以尝试删除`chat_history.db`文件
   - 应用会在下次启动时自动创建新的数据库

5. **如何保存图表分析结果?**
   - 如果配置了阿里云OSS，图表会自动上传并在对话中显示
   - 如果没有配置OSS，可以在`charts`目录下找到生成的图表文件
   - 也可以通过右键点击图表另存为本地文件 